You are my lead engineer. Work only in this repo. Create a new branch: profiles-displaynames.

Goal
Comments and threads must show the signed-in user’s profile.display_name instead of the raw email. Store authorId on create, and render names by looking up profiles. Keep a safe fallback to the email prefix if no profile row exists.

Tasks
1) Profiles utilities
- Add /lib/profiles.ts with:
  • getProfile(id): SELECT id, display_name, avatar_url FROM public.profiles WHERE id = $id
  • getProfiles(ids: string[]): batch lookup using IN (...) and return a map {id -> profile}
  • upsertSelf(user): best-effort upsert({ id: user.id, display_name: user.user_metadata.full_name || user.email, avatar_url: user.user_metadata.avatar_url })
- Export a React hook useProfile(id) that caches results in-memory (Map) to avoid repeat queries.

2) Auth on sign-in
- In AuthProvider (or wherever session is set), after a successful sign-in call upsertSelf(session.user). Ignore errors.

3) Comment and thread creation
- Find the comment composer and thread composer code. When submitting, set comment.authorId = session.user.id (and thread.authorId likewise). Keep any existing authorName field for backward compatibility, but the UI should ignore it.

4) Rendering names
- Find the component(s) that render a comment and a thread card (files like components/Comment*, CommentItem*, ThreadCard*, etc).
- Replace any use of session.user.email or hardcoded names with a tiny <AuthorName userId="..."> component that:
  • calls useProfile(userId)
  • shows profile.display_name if present
  • else shows the email prefix (e.g., “thevirtuohub”) as a temporary fallback
- Do not change visual styles. Use existing typography and avatar components.

5) Test
- Add a Playwright test: sign in, post a comment, the rendered author label equals your profile.display_name (not the full email).

Constraints
- Do not touch Pulse or thread storage logic.
- No color or layout changes.
- Never use the service role key.

Deliverables
- /lib/profiles.ts with utils and useProfile hook
- Updated composers to set authorId
- Updated comment/thread rendering to use profile.display_name
- Passing Playwright test
- CHANGELOG.md entry: “Comments render profile display names; authorId stored on create; profile upsert on sign-in”
